<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PU Machine Operation Parameters Calculator</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H54NMKEF6S"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-H54NMKEF6S');
    </script>
    
    <script src="config.js"></script>
    <script>
      const excelData = {
        "initial_values": {
          "line_speed": 8,
          "output": 88,
          "concentration": 0,
          "ratio": 1.65
        },
        "calculation_results": {
          "O_gs": 0,
          "C_gm": 660,
          "L_mmin": null
        },
        "part2": {
          "linespeed": 7,
          "test_time": 4,
          "polyol_weight": 120,
          "iso_weight": 180,
          "polyol_rpm": 30,
          "iso_rpm": 40,
          "ratio": 1.5,
          "output_gs": 75.0,
          "consumption_gm": 642.86
        },
        "part3": {
          "new_linespeed": 8,
          "new_consumption_gm": 670,
          "new_ratio": 1.4,
          "output_gs": 89.33,
          "polyol_weight_gs": 37.22,
          "iso_weight_gs": 52.11,
          "polyol_rpm": 37.22,
          "iso_rpm": 46.32,
          "source_part2_linespeed": 7,
          "source_part2_ratio": 1.5,
          "source_part2_polyol_rpm": 30,
          "source_part2_iso_rpm": 40
        }
      };
      // Initialize language
      let currentLanguage = 'en';

      // Language translations
      const translations = {
        en: {
          title: "PU Machine Operation Parameters Calculator",
          subtitle: "Specialized calculator for polyurethane spraying process",
          howToUse: "how to use",
          part1: "Part 1: Basic Calculator",
          part2: "Part 2: Test Data Analysis",
          part3: "Part 3: Parameter Adjustment",
          formula_desc: "Where: O (Output), C (Consumption), L (Line speed)",
          lineSpeed: "L - Line Speed",
          output: "O - Output",
          consumption: "C - Consumption",
          ratio: "Ratio",
          calculate: "Calculate",
          clearData: "Clear Data",
          calculationResults: "Calculation Results",
          materialAnalysis: "Material Component Analysis",
          testDataAnalysis: "Test Data Analysis",
          testDataDesc: "Calculate parameters based on actual test data",
          testLineSpeed: "L - Test Line Speed",
          testTime: "T - Test Time",
          polyolWeight: "P - Polyol Weight",
          isocyanateWeight: "I - Isocyanate Weight",
          polyolRPM: "PR - Polyol RPM",
          isoRPM: "IR - Iso RPM",
          part2Results: "Part 2 Results",
          parameterAdjustment: "Parameter Adjustment",
          parameterDesc: "Adjust parameters based on Part 2 results",
          newLineSpeed: "Ln - New Line Speed",
          newConsumption: "Cn - New Consumption",
          newRatio: "Rn - New Ratio",
          part3Results: "Part 3 Results",
          rpmAdjustment: "RPM Adjustment Parameters",
          totalOutput: "Total Output",
          componentWeights: "Component Weights (per second)",
          timeBasedBreakdown: "Time-based Breakdown",
          total: "Total",
          unitMMin: "Unit: m/min",
          unitGs: "Unit: g/s",
          unitGm: "Unit: g/m",
          unitSeconds: "Unit: seconds",
          unitGPerT: "Unit: g (per T seconds)",
          unitHz: "Unit: Hz",
          isoPolRatio: "Iso/Pol Ratio",
          placeholder: "Enter 0 to calculate",
          errorMandatory: "Please enter all mandatory Part 2 parameters (L, T, P, I).",
          errorRPMWarning: "Warning: PR (Polyol RPM) and IR (Iso RPM) are not provided. RPM calculations in Part 3 will be inaccurate without these values.",
          errorPart1: "Please enter 0 for exactly one parameter to calculate.",
          errorPart3: "Please enter all Part 3 parameters.",
          errorRatioRequired: "Ratio is mandatory and cannot be blank or zero.",
          mass: "Mass",
          clipboardHeaders: {
            part1: "Part 1: Basic Calculator",
            part2: "Part 2: Test Data Analysis", 
            part3: "Part 3: Parameter Adjustment",
            inputParameters: "Input Parameters",
            results: "Results",
            calculated: "calculated"
          },
          instructions: {
            title: "How to Use the PU Machine Calculator",
            part1Title: "Part 1: Basic Calculator",
            part2Title: "Part 2: Test Data Analysis", 
            part3Title: "Part 3: Parameter Adjustment",
            stepGuideTitle: "Step-by-Step Guide:",
            part1Desc: "Basic Formula Calculator - Use this to calculate one unknown parameter when you have the other two values. Enter 0 for the parameter you want to calculate.",
            part2Desc: "Test Data Analysis - Input actual test measurements to calculate operational parameters and ratios based on real production data.",
            part3Desc: "Parameter Adjustment - Use results from Part 2 to calculate new operational parameters for different production requirements.",
            steps: [
              "Choose the appropriate section (Part 1, 2, or 3) based on your needs",
              "Fill in the known values in the input fields", 
              "For Part 1: Enter 0 in the field you want to calculate",
              "Click Calculate to get results",
              "Results are automatically copied to clipboard",
              "Use Clear Data to reset the form"
            ],
            formula: "Basic Formula: O = C × L (Output = Consumption × Line Speed)",
            notes: "Note: Ratio is always required and cannot be zero. RPM values in Part 2 are optional but recommended for accurate Part 3 calculations."
          },
          language: "Language"
        },
        vi: {
          title: "Máy Tính Thông Số Hoạt Động Máy Phun PU",
          subtitle: "Máy tính chuyên dụng cho quá trình phun polyurethane",
          howToUse: "cách sử dụng",
          part1: "Phần 1: Máy Tính Cơ Bản",
          part2: "Phần 2: Phân Tích Dữ Liệu Test",
          part3: "Phần 3: Điều Chỉnh Thông Số",
          formula_desc: "Trong đó: O (Sản lượng), C (Tiêu hao), L (Tốc độ dây chuyền)",
          lineSpeed: "L - Tốc Độ Dây Chuyền",
          output: "O - Sản Lượng",
          consumption: "C - Tiêu Hao",
          ratio: "Tỷ Lệ",
          calculate: "Tính Toán",
          clearData: "Xóa Dữ Liệu",
          calculationResults: "Kết Quả Tính Toán",
          materialAnalysis: "Phân Tích Thành Phần Vật Liệu",
          testDataAnalysis: "Phân Tích Dữ Liệu Test",
          testDataDesc: "Tính toán các thông số dựa trên dữ liệu test thực tế",
          testLineSpeed: "L - Tốc Độ Dây Chuyền Test",
          testTime: "T - Thời Gian Test",
          polyolWeight: "P - Khối Lượng Polyol",
          isocyanateWeight: "I - Khối Lượng Isocyanate",
          polyolRPM: "PR - Polyol RPM",
          isoRPM: "IR - Iso RPM",
          part2Results: "Kết Quả Phần 2",
          parameterAdjustment: "Điều Chỉnh Thông Số",
          parameterDesc: "Điều chỉnh thông số dựa trên kết quả Phần 2",
          newLineSpeed: "Ln - Tốc Độ Dây Chuyền Mới",
          newConsumption: "Cn - Tiêu Hao Mới",
          newRatio: "Rn - Tỷ Lệ Mới",
          part3Results: "Kết Quả Phần 3",
          rpmAdjustment: "Thông Số Điều Chỉnh RPM",
          totalOutput: "Tổng Sản Lượng",
          componentWeights: "Khối Lượng Thành Phần (mỗi giây)",
          timeBasedBreakdown: "Phân Tích Theo Thời Gian",
          total: "Tổng",
          unitMMin: "Đơn vị: m/phút",
          unitGs: "Đơn vị: g/s",
          unitGm: "Đơn vị: g/m",
          unitSeconds: "Đơn vị: giây",
          unitGPerT: "Đơn vị: g (mỗi T giây)",
          unitHz: "Đơn vị: Hz",
          isoPolRatio: "Tỷ Lệ Iso/Pol",
          placeholder: "Nhập 0 để tính toán",
          errorMandatory: "Vui lòng nhập tất cả thông số bắt buộc Phần 2 (L, T, P, I).",
          errorRPMWarning: "Cảnh báo: PR (Polyol RPM) và IR (Iso RPM) không được cung cấp. Tính toán RPM ở Phần 3 sẽ không chính xác.",
          errorPart1: "Vui lòng nhập 0 cho chính xác một thông số để tính toán.",
          errorPart3: "Vui lòng nhập tất cả thông số Phần 3.",
          errorRatioRequired: "Tỷ lệ là bắt buộc và không thể để trống hoặc bằng không.",
          mass: "Khối Lượng",
          clipboardHeaders: {
            part1: "Phần 1: Máy Tính Cơ Bản",
            part2: "Phần 2: Phân Tích Dữ Liệu Test",
            part3: "Phần 3: Điều Chỉnh Thông Số",
            inputParameters: "Thông Số Đầu Vào",
            results: "Kết Quả",
            calculated: "được tính toán"
          },
          instructions: {
            title: "Cách Sử Dụng Máy Tính PU",
            part1Title: "Phần 1: Máy Tính Cơ Bản",
            part2Title: "Phần 2: Phân Tích Dữ Liệu Test", 
            part3Title: "Phần 3: Điều Chỉnh Thông Số",
            stepGuideTitle: "Hướng Dẫn Từng Bước:",
            part1Desc: "Máy Tính Công Thức Cơ Bản - Dùng để tính một thông số chưa biết khi bạn có hai giá trị còn lại. Nhập 0 cho thông số bạn muốn tính.",
            part2Desc: "Phân Tích Dữ Liệu Test - Nhập các phép đo test thực tế để tính các thông số hoạt động và tỷ lệ dựa trên dữ liệu sản xuất thực.",
            part3Desc: "Điều Chỉnh Thông Số - Sử dụng kết quả từ Phần 2 để tính các thông số hoạt động mới cho các yêu cầu sản xuất khác nhau.",
            steps: [
              "Chọn phần phù hợp (Phần 1, 2, hoặc 3) theo nhu cầu của bạn",
              "Điền các giá trị đã biết vào các ô nhập liệu",
              "Đối với Phần 1: Nhập 0 vào ô bạn muốn tính",
              "Nhấn Tính Toán để có kết quả",
              "Kết quả được tự động sao chép vào clipboard",
              "Dùng Xóa Dữ Liệu để reset form"
            ],
            formula: "Công Thức Cơ Bản: O = C × L (Sản Lượng = Tiêu Hao × Tốc Độ Dây Chuyền)",
            notes: "Lưu ý: Tỷ lệ luôn bắt buộc và không thể bằng không. Giá trị RPM trong Phần 2 là tùy chọn nhưng khuyến khích để tính toán chính xác ở Phần 3."
          },
          language: "Ngôn ngữ"
        },
        th: {
          title: "เครื่องคำนวณพารามิเตอร์การทำงานเครื่องพ่น PU",
          subtitle: "เครื่องคำนวณเฉพาะสำหรับกระบวนการพ่นโพลียูรีเทน",
          howToUse: "วิธีใช้",
          part1: "ส่วนที่ 1: เครื่องคำนวณพื้นฐาน",
          part2: "ส่วนที่ 2: การวิเคราะห์ข้อมูลทดสอบ",
          part3: "ส่วนที่ 3: การปรับพารามิเตอร์",
          formula_desc: "โดยที่: O (ผลผลิต), C (การใช้), L (ความเร็วสาย)",
          lineSpeed: "L - ความเร็วสาย",
          output: "O - ผลผลิต",
          consumption: "C - การใช้",
          ratio: "อัตราส่วน",
          calculate: "คำนวณ",
          clearData: "ล้างข้อมูล",
          calculationResults: "ผลการคำนวณ",
          materialAnalysis: "การวิเคราะห์องค์ประกอบวัสดุ",
          testDataAnalysis: "การวิเคราะห์ข้อมูลทดสอบ",
          testDataDesc: "คำนวณพารามิเตอร์จากข้อมูลทดสอบจริง",
          testLineSpeed: "L - ความเร็วสายทดสอบ",
          testTime: "T - เวลาทดสอบ",
          polyolWeight: "P - น้ำหนัก Polyol",
          isocyanateWeight: "I - น้ำหนัก Isocyanate",
          polyolRPM: "PR - Polyol RPM",
          isoRPM: "IR - Iso RPM",
          part2Results: "ผลลัพธ์ส่วนที่ 2",
          parameterAdjustment: "การปรับพารามิเตอร์",
          parameterDesc: "ปรับพารามิเตอร์จากผลลัพธ์ส่วนที่ 2",
          newLineSpeed: "Ln - ความเร็วสายใหม่",
          newConsumption: "Cn - การใช้ใหม่",
          newRatio: "Rn - อัตราส่วนใหม่",
          part3Results: "ผลลัพธ์ส่วนที่ 3",
          rpmAdjustment: "พารามิเตอร์ปรับ RPM",
          totalOutput: "ผลผลิตรวม",
          componentWeights: "น้ำหนักองค์ประกอบ (ต่อวินาที)",
          timeBasedBreakdown: "การแบ่งตามเวลา",
          total: "รวม",
          unitMMin: "หน่วย: ม./นาที",
          unitGs: "หน่วย: ก./วินาที",
          unitGm: "หน่วย: ก./ม.",
          unitSeconds: "หน่วย: วินาที",
          unitGPerT: "หน่วย: ก. (ต่อ T วินาที)",
          unitHz: "หน่วย: Hz",
          isoPolRatio: "อัตราส่วน Iso/Pol",
          placeholder: "ใส่ 0 เพื่อคำนวณ",
          errorMandatory: "กรุณากรอกพารามิเตอร์บังคับทั้งหมดของส่วนที่ 2 (L, T, P, I)",
          errorRPMWarning: "คำเตือน: PR (Polyol RPM) และ IR (Iso RPM) ไม่ได้ระบุ การคำนวณ RPM ในส่วนที่ 3 จะไม่ถูกต้อง",
          errorPart1: "กรุณาใส่ 0 สำหรับพารามิเตอร์เดียวเพื่อคำนวณ",
          errorPart3: "กรุณากรอกพารามิเตอร์ส่วนที่ 3 ทั้งหมด",
          errorRatioRequired: "อัตราส่วนเป็นค่าบังคับและไม่สามารถเว้นว่างหรือเป็นศูนย์ได้",
          mass: "มวล",
          clipboardHeaders: {
            part1: "ส่วนที่ 1: เครื่องคำนวณพื้นฐาน",
            part2: "ส่วนที่ 2: การวิเคราะห์ข้อมูลทดสอบ",
            part3: "ส่วนที่ 3: การปรับพารามิเตอร์",
            inputParameters: "พารามิเตอร์อินพุต",
            results: "ผลลัพธ์",
            calculated: "คำนวณแล้ว"
          },
          instructions: {
            title: "วิธีใช้เครื่องคำนวณ PU",
            part1Title: "ส่วนที่ 1: เครื่องคำนวณพื้นฐาน",
            part2Title: "ส่วนที่ 2: การวิเคราะห์ข้อมูลทดสอบ", 
            part3Title: "ส่วนที่ 3: การปรับพารามิเตอร์",
            stepGuideTitle: "คู่มือทีละขั้นตอน:",
            part1Desc: "เครื่องคำนวณสูตรพื้นฐาน - ใช้คำนวณพารามิเตอร์ที่ไม่ทราบค่าเมื่อมีค่าอื่นสองค่า ใส่ 0 สำหรับพารามิเตอร์ที่ต้องการคำนวณ",
            part2Desc: "การวิเคราะห์ข้อมูลทดสอบ - ใส่ข้อมูลการทดสอบจริงเพื่อคำนวณพารามิเตอร์การทำงานและอัตราส่วนจากข้อมูลการผลิตจริง",
            part3Desc: "การปรับพารามิเตอร์ - ใช้ผลลัพธ์จากส่วนที่ 2 เพื่อคำนวณพารามิเตอร์การทำงานใหม่สำหรับความต้องการการผลิตที่แตกต่างกัน",
            steps: [
              "เลือกส่วนที่เหมาะสม (ส่วนที่ 1, 2, หรือ 3) ตามความต้องการ",
              "กรอกค่าที่ทราบในช่องข้อมูลนำเข้า",
              "สำหรับส่วนที่ 1: ใส่ 0 ในช่องที่ต้องการคำนวณ",
              "คลิกคำนวณเพื่อได้ผลลัพธ์",
              "ผลลัพธ์จะถูกคัดลอกไปยังคลิปบอร์ดโดยอัตโนมัติ",
              "ใช้ล้างข้อมูลเพื่อรีเซ็ตฟอร์ม"
            ],
            formula: "สูตรพื้นฐาน: O = C × L (ผลผลิต = การใช้ × ความเร็วสาย)",
            notes: "หมายเหตุ: อัตราส่วนจำเป็นต้องใส่เสมอและไม่สามารถเป็นศูนย์ได้ ค่า RPM ในส่วนที่ 2 เป็นตัวเลือกแต่แนะนำให้ใส่เพื่อการคำนวณที่แม่นยำในส่วนที่ 3"
          },
          language: "ภาษา"
        },
        cn: {
          title: "PU喷涂机操作参数计算器",
          subtitle: "聚氨酯喷涂工艺专用计算器",
          howToUse: "如何使用",
          part1: "第1部分：基础计算器",
          part2: "第2部分：测试数据分析",
          part3: "第3部分：参数调整",
          formula_desc: "其中：O（产量），C（消耗），L（线速度）",
          lineSpeed: "L - 线速度",
          output: "O - 产量",
          consumption: "C - 消耗",
          ratio: "比例",
          calculate: "计算",
          clearData: "清除数据",
          calculationResults: "计算结果",
          materialAnalysis: "材料成分分析",
          testDataAnalysis: "测试数据分析",
          testDataDesc: "基于实际测试数据计算参数",
          testLineSpeed: "L - 测试线速度",
          testTime: "T - 测试时间",
          polyolWeight: "P - 聚醚重量",
          isocyanateWeight: "I - 异氰酸酯重量",
          polyolRPM: "PR - 聚醚转速",
          isoRPM: "IR - 异氰酸酯转速",
          part2Results: "第2部分结果",
          parameterAdjustment: "参数调整",
          parameterDesc: "基于第2部分结果调整参数",
          newLineSpeed: "Ln - 新线速度",
          newConsumption: "Cn - 新消耗",
          newRatio: "Rn - 新比例",
          part3Results: "第3部分结果",
          rpmAdjustment: "转速调整参数",
          totalOutput: "总产量",
          componentWeights: "组件重量（每秒）",
          timeBasedBreakdown: "基于时间的分解",
          total: "总计",
          unitMMin: "单位：米/分钟",
          unitGs: "单位：克/秒",
          unitGm: "单位：克/米",
          unitSeconds: "单位：秒",
          unitGPerT: "单位：克（每T秒）",
          unitHz: "单位：赫兹",
          isoPolRatio: "异氰酸酯/聚醚比例",
          placeholder: "输入0进行计算",
          errorMandatory: "请输入第2部分所有必需参数（L，T，P，I）。",
          errorRPMWarning: "警告：未提供PR（聚醚转速）和IR（异氰酸酯转速）。第3部分的转速计算将不准确。",
          errorPart1: "请为一个参数输入0进行计算。",
          errorPart3: "请输入第3部分的所有参数。",
          errorRatioRequired: "比例是必填项，不能为空或为零。",
          mass: "质量",
          clipboardHeaders: {
            part1: "第1部分：基础计算器",
            part2: "第2部分：测试数据分析",
            part3: "第3部分：参数调整",
            inputParameters: "输入参数",
            results: "结果",
            calculated: "已计算"
          },
          instructions: {
            title: "如何使用PU计算器",
            part1Title: "第1部分：基础计算器",
            part2Title: "第2部分：测试数据分析", 
            part3Title: "第3部分：参数调整",
            stepGuideTitle: "逐步指南:",
            part1Desc: "基础公式计算器 - 当您有其他两个值时，用于计算一个未知参数。在要计算的参数中输入0。",
            part2Desc: "测试数据分析 - 输入实际测试测量值，根据真实生产数据计算操作参数和比例。",
            part3Desc: "参数调整 - 使用第2部分的结果为不同的生产要求计算新的操作参数。",
            steps: [
              "根据需要选择合适的部分（第1、2或3部分）",
              "在输入字段中填入已知值",
              "对于第1部分：在要计算的字段中输入0",
              "点击计算获得结果",
              "结果自动复制到剪贴板",
              "使用清除数据重置表单"
            ],
            formula: "基础公式：O = C × L（产量 = 消耗 × 线速度）",
            notes: "注意：比例始终是必需的，不能为零。第2部分中的RPM值是可选的，但建议填写以确保第3部分计算的准确性。"
          },
          language: "语言"
        }
      };

      // Current language
      let currentLang = 'en';

      // Google Sheets Integration Configuration
      const GOOGLE_SHEETS_CONFIG = {
        webAppUrl: (typeof CONFIG !== 'undefined' && CONFIG.GOOGLE_SHEETS_WEBAPP_URL) ? 
          CONFIG.GOOGLE_SHEETS_WEBAPP_URL : 
          // Fallback: Base64 encoded URL (basic obfuscation)
          atob('aHR0cHM6Ly9zY3JpcHQuZ29vZ2xlLmNvbS9tYWNyb3Mvcy9BS2Z5Y2J6a1BBWHF0REIxM1ZBcXBqLTZvZkxKZlJReTlZcG9vb1BhZTFJd1VzWFlWSEhsbVpsdE93MzVpa0pCMGVjRlFwRHUvZXhlYw=='),
        enabled: true
      };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            font-size: 12px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.9em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .language-selector {
            margin-top: 15px;
            font-size: 1.1em;
        }

        .lang-link {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .lang-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .lang-link.active {
            background-color: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }

        .main-content {
            padding: 20px;
        }

        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }

        .section.part2 {
            border-left-color: #e67e22;
        }

        .section.part3 {
            border-left-color: #9b59b6;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .formula-display {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-field {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .input-field:focus-within {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .input-field label {
            display: block;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .input-field input {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1.2em;
            transition: border-color 0.3s;
        }

        .input-field input:focus {
            outline: none;
            border-color: #3498db;
        }

        .input-field .unit {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .calculate-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 16px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            min-height: 48px;
            touch-action: manipulation;
            line-height: 1.2;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
        }

        .calculate-btn.part2 {
            background: linear-gradient(45deg, #e67e22, #d35400);
        }

        .calculate-btn.part3 {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .results {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .results h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .result-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .result-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .result-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #27ae60;
        }

        .material-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .material-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .material-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .material-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #8e44ad;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .error {
            color: #e74c3c;
            font-weight: 600;
        }

        .warning {
            background: #f39c12;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .footer {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-radius: 0 0 15px 15px;
        }

        .footer p {
            margin: 0;
            font-size: 1.1em;
            font-weight: 500;
            opacity: 0.9;
        }

        .part-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .nav-btn:not(.active) {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
                font-size: 11px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .calculate-btn {
                width: 100%;
                margin-right: 0;
            }
            
            .part-navigation {
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PU Machine Operation Parameters Calculator</h1>
            <div style="margin-top: 10px; margin-bottom: 10px;">
                <button id="howToUseLink" onclick="toggleInstructions()" style="color: #ffffff; background-color: rgba(255, 255, 255, 0.2); border: none; padding: 8px 16px; border-radius: 5px; font-size: 0.9em; transition: all 0.3s ease; cursor: pointer;" 
                   onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.3)'" 
                   onmouseout="this.style.backgroundColor='rgba(255, 255, 255, 0.2)'">
                    how to use
                </button>
            </div>
            <div class="language-selector">
                <span id="languageLabel" style="font-size: 1.1em; opacity: 0.9;">Language: </span>
                <span class="lang-link active" onclick="switchLanguage('en')">English</span>
                <span style="opacity: 0.7;"> | </span>
                <span class="lang-link" onclick="switchLanguage('vi')">Việt</span>
                <span style="opacity: 0.7;"> | </span>
                <span class="lang-link" onclick="switchLanguage('th')">ไทย</span>
                <span style="opacity: 0.7;"> | </span>
                <span class="lang-link" onclick="switchLanguage('cn')">中文</span>
            </div>
        </div>

        <div class="main-content">
            <!-- Collapsible Instructions Section -->
            <div id="instructionsSection" style="display: none; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #17a2b8;">
                <h2 id="instructionsTitle" style="color: #2c3e50; margin-bottom: 15px; font-size: 1.4em;">How to Use the PU Machine Calculator</h2>
                
                <div style="background: #ffffff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div id="instructionsFormula" style="background: #2c3e50; color: white; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 1.1em; text-align: center; margin-bottom: 15px;">
                        Basic Formula: O = C × L (Output = Consumption × Line Speed)
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: #ffffff; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                        <h4 id="instructionsPart1Title" style="color: #3498db; margin-bottom: 10px;">Part 1: Basic Calculator</h4>
                        <p id="instructionsPart1" style="color: #555; line-height: 1.5;">Basic Formula Calculator - Use this to calculate one unknown parameter when you have the other two values. Enter 0 for the parameter you want to calculate.</p>
                    </div>
                    <div style="background: #ffffff; padding: 15px; border-radius: 8px; border-left: 4px solid #e67e22;">
                        <h4 id="instructionsPart2Title" style="color: #e67e22; margin-bottom: 10px;">Part 2: Test Data Analysis</h4>
                        <p id="instructionsPart2" style="color: #555; line-height: 1.5;">Test Data Analysis - Input actual test measurements to calculate operational parameters and ratios based on real production data.</p>
                    </div>
                    <div style="background: #ffffff; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6;">
                        <h4 id="instructionsPart3Title" style="color: #9b59b6; margin-bottom: 10px;">Part 3: Parameter Adjustment</h4>
                        <p id="instructionsPart3" style="color: #555; line-height: 1.5;">Parameter Adjustment - Use results from Part 2 to calculate new operational parameters for different production requirements.</p>
                    </div>
                </div>

                <div style="background: #ffffff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 id="instructionsStepGuideTitle" style="color: #2c3e50; margin-bottom: 10px;">Step-by-Step Guide:</h4>
                    <ol id="instructionsSteps" style="color: #555; line-height: 1.8; padding-left: 20px;">
                        <li>Choose the appropriate section (Part 1, 2, or 3) based on your needs</li>
                        <li>Fill in the known values in the input fields</li>
                        <li>For Part 1: Enter 0 in the field you want to calculate</li>
                        <li>Click Calculate to get results</li>
                        <li>Results are automatically copied to clipboard</li>
                        <li>Use Clear Data to reset the form</li>
                    </ol>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <p id="instructionsNotes" style="color: #856404; margin: 0; font-weight: 500;">
                        Note: Ratio is always required and cannot be zero. RPM values in Part 2 are optional but recommended for accurate Part 3 calculations.
                    </p>
                </div>
            </div>
            
            <div class="part-navigation">
                <button class="nav-btn active" onclick="showPart(1)">Part 1: Basic Calculator</button>
                <button class="nav-btn" onclick="showPart(2)">Part 2: Test Data Analysis</button>
                <button class="nav-btn" onclick="showPart(3)">Part 3: Parameter Adjustment</button>
            </div>

            <!-- Part 1: Basic Calculator -->
            <div id="part1-section" class="section">
                <h2>Part 1: Basic Formula Calculator</h2>
                <div class="formula-display">
                    O = C × L
                </div>
                <p style="text-align: center; color: #7f8c8d; font-size: 1.1em; margin-bottom: 20px;">
                    O (Output), C (Consumption), L (Line speed)
                </p>

                <div class="input-group">
                    <div class="input-field">
                        <label for="ratio">Ratio</label>
                        <input type="number" id="ratio" value="1.65" step="0.01" inputmode="decimal">
                        <div class="unit">Iso/Pol Ratio</div>
                    </div>
                    <div class="input-field">
                        <label for="lineSpeed">L - Line Speed</label>
                        <input type="number" id="lineSpeed" step="0.1" placeholder="Enter 0 to calculate" inputmode="decimal">
                        <div class="unit">Unit: m/min</div>
                    </div>
                    <div class="input-field">
                        <label for="output">O - Output</label>
                        <input type="number" id="output" step="0.01" placeholder="Enter 0 to calculate" inputmode="decimal">
                        <div class="unit">Unit: g/s</div>
                    </div>
                    <div class="input-field">
                        <label for="concentration">C - Consumption</label>
                        <input type="number" id="concentration" step="0.01" placeholder="Enter 0 to calculate" inputmode="decimal">
                        <div class="unit">Unit: g/m</div>
                    </div>
                </div>

                <button type="button" class="calculate-btn" onclick="calculateBasic()">Calculate</button>
                <button type="button" class="calculate-btn" onclick="clearPart1()">Clear Data</button>

                <div id="part1-results" style="display: none;">
                    <div class="results">
                        <h3>Calculation Results</h3>
                        <div id="part1-result-content"></div>
                    </div>
                    
                    <div class="results">
                        <h3>Material Component Analysis</h3>
                        <div class="material-breakdown" id="part1MaterialBreakdown"></div>
                    </div>
                </div>
            </div>

            <!-- Part 2: Test Data Analysis -->
            <div id="part2-section" class="section part2" style="display: none;">
                <h2>Part 2: Test Data Analysis</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Calculate parameters based on actual test data</p>
                
                <div class="input-group">
                    <div class="input-field">
                        <label for="part2_linespeed">L - Test Line Speed</label>
                        <input type="number" id="part2_linespeed" step="0.1" inputmode="decimal">
                        <div class="unit">Unit: m/min</div>
                    </div>
                    <div class="input-field">
                        <label for="part2_test_time">T - Test Time</label>
                        <input type="number" id="part2_test_time" step="1" inputmode="decimal">
                        <div class="unit">Unit: seconds</div>
                    </div>
                    <div class="input-field">
                        <label for="part2_polyol">P - Polyol Weight</label>
                        <input type="number" id="part2_polyol" step="0.1" inputmode="decimal">
                        <div class="unit">Unit: g (per T seconds)</div>
                    </div>
                    <div class="input-field">
                        <label for="part2_iso">I - Isocyanate Weight</label>
                        <input type="number" id="part2_iso" step="0.1" inputmode="decimal">
                        <div class="unit">Unit: g (per T seconds)</div>
                    </div>
                    <div class="input-field">
                        <label for="part2_polyol_rpm">PR - Polyol RPM</label>
                        <input type="number" id="part2_polyol_rpm" step="0.1" inputmode="decimal">
                        <div class="unit">Unit: Hz</div>
                    </div>
                    <div class="input-field">
                        <label for="part2_iso_rpm">IR - Iso RPM</label>
                        <input type="number" id="part2_iso_rpm" step="0.1" inputmode="decimal">
                        <div class="unit">Unit: Hz</div>
                    </div>
                </div>

                <button type="button" class="calculate-btn part2" onclick="calculatePart2()">Calculate</button>
                <button type="button" class="calculate-btn part2" onclick="clearPart2()">Clear Data</button>

                <div class="results" id="part2-results" style="display: none;">
                    <h3>Part 2 Results</h3>
                    <div id="part2-result-content"></div>
                </div>
            </div>

            <!-- Part 3: Parameter Adjustment -->
            <div id="part3-section" class="section part3" style="display: none;">
                <h2>Part 3: Parameter Adjustment</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Adjust parameters based on Part 2 results</p>
                
                <div class="input-group">
                    <div class="input-field">
                        <label for="part3_new_linespeed">Ln - New Line Speed</label>
                        <input type="number" id="part3_new_linespeed" step="0.1" inputmode="decimal">
                        <div class="unit">Unit: m/min</div>
                    </div>
                    <div class="input-field">
                        <label for="part3_new_consumption">Cn - New Consumption</label>
                        <input type="number" id="part3_new_consumption" step="1" inputmode="decimal">
                        <div class="unit">Unit: g/m</div>
                    </div>
                    <div class="input-field">
                        <label for="part3_new_ratio">Rn - New Ratio</label>
                        <input type="number" id="part3_new_ratio" step="0.01" inputmode="decimal">
                        <div class="unit">Iso/Pol Ratio</div>
                    </div>
                </div>

                <button type="button" class="calculate-btn part3" onclick="calculatePart3()">Calculate</button>
                <button type="button" class="calculate-btn part3" onclick="clearPart3()">Clear Data</button>

                <div class="results" id="part3-results" style="display: none;">
                    <h3>Part 3 Results</h3>
                    <div id="part3-result-content"></div>
                    
                    <div class="results" style="margin-top: 20px;">
                        <h3>RPM Adjustment Parameters</h3>
                        <div id="part3-rpm-content"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Binh D. Nguyen - Interfoam</p>
        </div>
    </div>

    <script>
        // Instructions toggle function
        function toggleInstructions() {
            const instructionsSection = document.getElementById('instructionsSection');
            if (instructionsSection.style.display === 'none') {
                instructionsSection.style.display = 'block';
            } else {
                instructionsSection.style.display = 'none';
            }
        }

        // Language switching function
        function switchLanguage(lang) {
            currentLang = lang;
            
            // Update active language selector
            document.querySelectorAll('.lang-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update all translatable elements
            updateTranslations();
        }
        
        function updateTranslations() {
            const t = translations[currentLang];
            
            // Update title
            document.querySelector('h1').textContent = t.title;
            
            // Update how to use button
            document.querySelector('#howToUseLink').textContent = t.howToUse;
            
            // Update language label
            document.querySelector('#languageLabel').textContent = t.language + ': ';
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn')[0].textContent = t.part1;
            document.querySelectorAll('.nav-btn')[1].textContent = t.part2;
            document.querySelectorAll('.nav-btn')[2].textContent = t.part3;
            
            // Update Part 1
            document.querySelector('#part1-section h2').textContent = t.part1;
            document.querySelector('#part1-section p').textContent = t.formula_desc;
            document.querySelector('label[for="lineSpeed"]').textContent = t.lineSpeed;
            document.querySelector('label[for="output"]').textContent = t.output;
            document.querySelector('label[for="concentration"]').textContent = t.consumption;
            document.querySelector('label[for="ratio"]').textContent = t.ratio;
            
            // Update units
            document.querySelectorAll('.unit')[0].textContent = t.unitMMin;
            document.querySelectorAll('.unit')[1].textContent = t.unitGs;
            document.querySelectorAll('.unit')[2].textContent = t.unitGm;
            document.querySelectorAll('.unit')[3].textContent = t.isoPolRatio;
            
            // Update placeholders
            document.querySelectorAll('input[placeholder]').forEach(input => {
                input.placeholder = t.placeholder;
            });
            
            // Update buttons
            document.querySelector('#part1-section .calculate-btn:first-of-type').textContent = t.calculate;
            document.querySelector('#part1-section .calculate-btn:last-of-type').textContent = t.clearData;
            
            // Update Part 2
            document.querySelector('#part2-section h2').textContent = t.part2;
            document.querySelector('#part2-section > p').textContent = t.testDataDesc;
            document.querySelector('label[for="part2_linespeed"]').textContent = t.testLineSpeed;
            document.querySelector('label[for="part2_test_time"]').textContent = t.testTime;
            document.querySelector('label[for="part2_polyol"]').textContent = t.polyolWeight;
            document.querySelector('label[for="part2_iso"]').textContent = t.isocyanateWeight;
            document.querySelector('label[for="part2_polyol_rpm"]').textContent = t.polyolRPM;
            document.querySelector('label[for="part2_iso_rpm"]').textContent = t.isoRPM;
            
            // Update Part 2 units
            const part2Units = document.querySelectorAll('#part2-section .unit');
            part2Units[0].textContent = t.unitMMin;
            part2Units[1].textContent = t.unitSeconds;
            part2Units[2].textContent = t.unitGPerT;
            part2Units[3].textContent = t.unitGPerT;
            part2Units[4].textContent = t.unitHz;
            part2Units[5].textContent = t.unitHz;
            
            // Update Part 2 buttons
            document.querySelector('#part2-section .calculate-btn:first-of-type').textContent = t.calculate;
            document.querySelector('#part2-section .calculate-btn:last-of-type').textContent = t.clearData;
            
            // Update Part 3
            document.querySelector('#part3-section h2').textContent = t.part3;
            document.querySelector('#part3-section > p').textContent = t.parameterDesc;
            document.querySelector('label[for="part3_new_linespeed"]').textContent = t.newLineSpeed;
            document.querySelector('label[for="part3_new_consumption"]').textContent = t.newConsumption;
            document.querySelector('label[for="part3_new_ratio"]').textContent = t.newRatio;
            
            // Update Part 3 units
            const part3Units = document.querySelectorAll('#part3-section .unit');
            part3Units[0].textContent = t.unitMMin;
            part3Units[1].textContent = t.unitGm;
            part3Units[2].textContent = t.isoPolRatio;
            
            // Update Part 3 buttons
            document.querySelector('#part3-section .calculate-btn:first-of-type').textContent = t.calculate;
            document.querySelector('#part3-section .calculate-btn:last-of-type').textContent = t.clearData;
            
            // Update result headings
            const resultHeadings = document.querySelectorAll('h3');
            if (resultHeadings[0]) resultHeadings[0].textContent = t.calculationResults;
            if (resultHeadings[1]) resultHeadings[1].textContent = t.materialAnalysis;
            if (resultHeadings[2]) resultHeadings[2].textContent = t.part2Results;
            if (resultHeadings[3]) resultHeadings[3].textContent = t.part3Results;
            if (resultHeadings[4]) resultHeadings[4].textContent = t.rpmAdjustment;
            
            // Update instructions content
            if (document.getElementById('instructionsTitle')) {
                document.getElementById('instructionsTitle').textContent = t.instructions.title;
            }
            if (document.getElementById('instructionsFormula')) {
                document.getElementById('instructionsFormula').textContent = t.instructions.formula;
            }
            if (document.getElementById('instructionsPart1Title')) {
                document.getElementById('instructionsPart1Title').textContent = t.instructions.part1Title;
            }
            if (document.getElementById('instructionsPart2Title')) {
                document.getElementById('instructionsPart2Title').textContent = t.instructions.part2Title;
            }
            if (document.getElementById('instructionsPart3Title')) {
                document.getElementById('instructionsPart3Title').textContent = t.instructions.part3Title;
            }
            if (document.getElementById('instructionsStepGuideTitle')) {
                document.getElementById('instructionsStepGuideTitle').textContent = t.instructions.stepGuideTitle;
            }
            if (document.getElementById('instructionsPart1')) {
                document.getElementById('instructionsPart1').textContent = t.instructions.part1Desc;
            }
            if (document.getElementById('instructionsPart2')) {
                document.getElementById('instructionsPart2').textContent = t.instructions.part2Desc;
            }
            if (document.getElementById('instructionsPart3')) {
                document.getElementById('instructionsPart3').textContent = t.instructions.part3Desc;
            }
            if (document.getElementById('instructionsNotes')) {
                document.getElementById('instructionsNotes').textContent = t.instructions.notes;
            }
            
            // Update instructions steps
            const stepsList = document.getElementById('instructionsSteps');
            if (stepsList) {
                stepsList.innerHTML = '';
                t.instructions.steps.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    stepsList.appendChild(li);
                });
            }
        }

        // Navigation between parts
        function showPart(partNumber) {
            // Hide all sections
            document.getElementById('part1-section').style.display = 'none';
            document.getElementById('part2-section').style.display = 'none';
            document.getElementById('part3-section').style.display = 'none';
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected section and activate nav button
            document.getElementById(`part${partNumber}-section`).style.display = 'block';
            document.querySelectorAll('.nav-btn')[partNumber - 1].classList.add('active');
        }

        // Part 1 Functions
        function calculateBasic() {
            const lineSpeed = parseFloat(document.getElementById('lineSpeed').value) || 0;
            const output = parseFloat(document.getElementById('output').value) || 0;
            const concentration = parseFloat(document.getElementById('concentration').value) || 0;
            const ratioValue = document.getElementById('ratio').value;
            const ratio = parseFloat(ratioValue);
            
            // Validate ratio is mandatory and not zero
            if (!ratioValue || isNaN(ratio) || ratio <= 0) {
                showError(translations[currentLang].errorRatioRequired);
                return;
            }

            const resultContainer = document.getElementById('part1-result-content');
            resultContainer.innerHTML = '';

            let clipboardText = `=== ${translations[currentLang].clipboardHeaders.part1} ===\n\n`;
            clipboardText += `${translations[currentLang].clipboardHeaders.inputParameters}:\n`;
            clipboardText += `${translations[currentLang].lineSpeed}: ${lineSpeed === 0 ? `0 (${translations[currentLang].clipboardHeaders.calculated})` : lineSpeed} ${translations[currentLang].unitMMin.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].output}: ${output === 0 ? `0 (${translations[currentLang].clipboardHeaders.calculated})` : output} ${translations[currentLang].unitGs.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].consumption}: ${concentration === 0 ? `0 (${translations[currentLang].clipboardHeaders.calculated})` : concentration} ${translations[currentLang].unitGm.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].ratio}: ${ratio}\n\n`;

            if (lineSpeed === 0 && output > 0 && concentration > 0) {
                const outputInGmin = output * 60;
                const calculatedL = outputInGmin / concentration;
                displayResult('part1-result-content', translations[currentLang].lineSpeed, calculatedL.toFixed(1), 'm/min');
                calculatePart1MaterialBreakdown(output, ratio);
                document.getElementById('part1-results').style.display = 'block';
                
                clipboardText += `${translations[currentLang].clipboardHeaders.results}:\n`;
                clipboardText += `${translations[currentLang].lineSpeed}: ${calculatedL.toFixed(1)} ${translations[currentLang].unitMMin.replace('Unit: ', '')}\n\n`;
                clipboardText += generatePart1MaterialText(output, ratio);
                
            } else if (output === 0 && lineSpeed > 0 && concentration > 0) {
                const calculatedO_gmin = concentration * lineSpeed;
                const calculatedO_gs = calculatedO_gmin / 60;
                
                displayResult('part1-result-content', translations[currentLang].output, calculatedO_gs.toFixed(2), 'g/s');
                calculatePart1MaterialBreakdown(calculatedO_gs, ratio);
                document.getElementById('part1-results').style.display = 'block';
                
                clipboardText += `${translations[currentLang].clipboardHeaders.results}:\n`;
                clipboardText += `${translations[currentLang].output}: ${calculatedO_gs.toFixed(2)} ${translations[currentLang].unitGs.replace('Unit: ', '')}\n\n`;
                clipboardText += generatePart1MaterialText(calculatedO_gs, ratio);
                
            } else if (concentration === 0 && lineSpeed > 0 && output > 0) {
                const outputInGmin = output * 60;
                const calculatedC = outputInGmin / lineSpeed;
                displayResult('part1-result-content', translations[currentLang].consumption, calculatedC.toFixed(2), 'g/m');
                calculatePart1MaterialBreakdown(output, ratio);
                document.getElementById('part1-results').style.display = 'block';
                
                clipboardText += `${translations[currentLang].clipboardHeaders.results}:\n`;
                clipboardText += `${translations[currentLang].consumption}: ${calculatedC.toFixed(2)} ${translations[currentLang].unitGm.replace('Unit: ', '')}\n\n`;
                clipboardText += generatePart1MaterialText(output, ratio);
                
            } else {
                showError(translations[currentLang].errorPart1);
                return;
            }

            // Copy to clipboard
            copyToClipboard(clipboardText);

            // Send data to Google Sheets
            const googleSheetsData = {
                part: 'part1',
                sheetName: 'Part1',
                language: currentLang,
                inputs: {
                    lineSpeed: lineSpeed,
                    output: output,
                    concentration: concentration,
                    ratio: ratio
                },
                results: {},
                materialBreakdown: {}
            };

            // Add results based on calculation type
            if (lineSpeed === 0) {
                const calculatedL = (output * 60) / concentration;
                googleSheetsData.results = {
                    calculatedType: 'Line Speed',
                    calculatedValue: calculatedL.toFixed(1),
                    calculatedUnit: 'm/min'
                };
            } else if (output === 0) {
                const calculatedO_gs = (concentration * lineSpeed) / 60;
                googleSheetsData.results = {
                    calculatedType: 'Output',
                    calculatedValue: calculatedO_gs.toFixed(2),
                    calculatedUnit: 'g/s'
                };
            } else if (concentration === 0) {
                const calculatedC = (output * 60) / lineSpeed;
                googleSheetsData.results = {
                    calculatedType: 'Consumption',
                    calculatedValue: calculatedC.toFixed(2),
                    calculatedUnit: 'g/m'
                };
            }

            // Add material breakdown
            const finalOutput = output === 0 ? (concentration * lineSpeed) / 60 : output;
            const totalRatio = 1 + ratio;
            const polAmount = finalOutput / totalRatio;
            const isoAmount = finalOutput * ratio / totalRatio;
            
            googleSheetsData.materialBreakdown = {
                '1s': { pol: polAmount.toFixed(1), iso: isoAmount.toFixed(1), total: (polAmount + isoAmount).toFixed(1) },
                '4s': { pol: (polAmount * 4).toFixed(1), iso: (isoAmount * 4).toFixed(1), total: ((polAmount + isoAmount) * 4).toFixed(1) },
                '6s': { pol: (polAmount * 6).toFixed(1), iso: (isoAmount * 6).toFixed(1), total: ((polAmount + isoAmount) * 6).toFixed(1) }
            };

            sendDataToGoogleSheets(googleSheetsData);
        }

        function generatePart1MaterialText(output, ratio) {
            const totalRatio = 1 + ratio;
            const polAmount = output / totalRatio;
            const isoAmount = output * ratio / totalRatio;

            let materialText = `${translations[currentLang].materialAnalysis}:\n`;
            const multipliers = [1, 4, 6];
            
            multipliers.forEach(multiplier => {
                const pol = polAmount * multiplier;
                const iso = isoAmount * multiplier;
                const sum = pol + iso;
                materialText += `Weight x ${multiplier}s: Pol: ${pol.toFixed(1)}g, Iso: ${iso.toFixed(1)}g, ${translations[currentLang].total}: ${sum.toFixed(1)}g\n`;
            });

            return materialText;
        }

        function calculatePart1MaterialBreakdown(output, ratio) {
            const container = document.getElementById('part1MaterialBreakdown');
            container.innerHTML = '';

            const totalRatio = 1 + ratio;
            const polAmount = output / totalRatio;
            const isoAmount = output * ratio / totalRatio;

            const multipliers = [1, 4, 6];
            
            multipliers.forEach(multiplier => {
                const pol = polAmount * multiplier;
                const iso = isoAmount * multiplier;
                const sum = pol + iso;

                const materialItem = document.createElement('div');
                materialItem.className = 'material-item';
                materialItem.innerHTML = `
                    <h4>Weight x ${multiplier}s</h4>
                    <div class="material-value">Pol: ${pol.toFixed(1)}g</div>
                    <div class="material-value">Iso: ${iso.toFixed(1)}g</div>
                    <div class="material-value">${translations[currentLang].total}: ${sum.toFixed(1)}g</div>
                `;
                container.appendChild(materialItem);
            });
        }

        function clearPart1() {
            document.getElementById('lineSpeed').value = '';
            document.getElementById('output').value = '';
            document.getElementById('concentration').value = '';
            document.getElementById('ratio').value = '1.65';
            document.getElementById('part1-result-content').innerHTML = '';
            document.getElementById('part1MaterialBreakdown').innerHTML = '';
            document.getElementById('part1-results').style.display = 'none';
        }

        // Part 2 Functions
        function calculatePart2() {
            const linespeed = parseFloat(document.getElementById('part2_linespeed').value) || 0;
            const testTime = parseFloat(document.getElementById('part2_test_time').value) || 0;
            const polyolWeight = parseFloat(document.getElementById('part2_polyol').value) || 0;
            const isoWeight = parseFloat(document.getElementById('part2_iso').value) || 0;
            const polyolRpm = parseFloat(document.getElementById('part2_polyol_rpm').value) || 0;
            const isoRpm = parseFloat(document.getElementById('part2_iso_rpm').value) || 0;

            if (linespeed <= 0 || testTime <= 0 || polyolWeight <= 0 || isoWeight <= 0) {
                showError(translations[currentLang].errorMandatory);
                return;
            }

            // Check if RPM values are missing and show warning
            if (polyolRpm <= 0 || isoRpm <= 0) {
                showError(translations[currentLang].errorRPMWarning);
            }

            const ratio = isoWeight / polyolWeight;
            const totalWeight = polyolWeight + isoWeight;
            const outputGs = totalWeight / testTime;
            const consumptionGM = (outputGs * 60) / linespeed;

            const resultContainer = document.getElementById('part2-result-content');
            resultContainer.innerHTML = '';

            displayResult('part2-result-content', translations[currentLang].ratio, ratio.toFixed(2), '');
            displayResult('part2-result-content', translations[currentLang].output, outputGs.toFixed(2), 'g/s');
            displayResult('part2-result-content', translations[currentLang].consumption, consumptionGM.toFixed(2), 'g/m');

            document.getElementById('part2-results').style.display = 'block';

            // Store Part 2 results for Part 3 to use
            window.part2Results = {
                ratio: ratio,
                outputGs: outputGs,
                consumptionGM: consumptionGM,
                polyolRpm: polyolRpm,
                isoRpm: isoRpm,
                linespeed: linespeed
            };

            // Auto-populate Part 3 inputs with Part 2 results
            document.getElementById('part3_new_linespeed').value = linespeed;
            document.getElementById('part3_new_consumption').value = Math.round(consumptionGM);
            document.getElementById('part3_new_ratio').value = ratio.toFixed(2);

            // Generate clipboard text
            let clipboardText = `=== ${translations[currentLang].clipboardHeaders.part2} ===\n\n`;
            clipboardText += `${translations[currentLang].clipboardHeaders.inputParameters}:\n`;
            clipboardText += `${translations[currentLang].testLineSpeed}: ${linespeed} ${translations[currentLang].unitMMin.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].testTime}: ${testTime} ${translations[currentLang].unitSeconds.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].polyolWeight}: ${polyolWeight} g\n`;
            clipboardText += `${translations[currentLang].isocyanateWeight}: ${isoWeight} g\n`;
            clipboardText += `${translations[currentLang].polyolRPM}: ${polyolRpm} ${translations[currentLang].unitHz.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].isoRPM}: ${isoRpm} ${translations[currentLang].unitHz.replace('Unit: ', '')}\n\n`;

            clipboardText += `${translations[currentLang].clipboardHeaders.results}:\n`;
            clipboardText += `${translations[currentLang].ratio}: ${ratio.toFixed(2)}\n`;
            clipboardText += `${translations[currentLang].output}: ${outputGs.toFixed(2)} ${translations[currentLang].unitGs.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].consumption}: ${consumptionGM.toFixed(2)} ${translations[currentLang].unitGm.replace('Unit: ', '')}\n\n`;

            // Copy to clipboard
            copyToClipboard(clipboardText);

            // Send data to Google Sheets
            const googleSheetsData = {
                part: 'part2',
                sheetName: 'Part2',
                language: currentLang,
                inputs: {
                    linespeed: linespeed,
                    testTime: testTime,
                    polyolWeight: polyolWeight,
                    isoWeight: isoWeight,
                    polyolRpm: polyolRpm,
                    isoRpm: isoRpm
                },
                results: {
                    ratio: ratio.toFixed(2),
                    outputGs: outputGs.toFixed(2),
                    consumptionGM: consumptionGM.toFixed(2)
                }
            };

            sendDataToGoogleSheets(googleSheetsData);
        }

        function clearPart2() {
            document.getElementById('part2_linespeed').value = '';
            document.getElementById('part2_test_time').value = '';
            document.getElementById('part2_polyol').value = '';
            document.getElementById('part2_iso').value = '';
            document.getElementById('part2_polyol_rpm').value = '';
            document.getElementById('part2_iso_rpm').value = '';
            document.getElementById('part2-result-content').innerHTML = '';
            document.getElementById('part2-results').style.display = 'none';
        }

        // Part 3 Functions
        function calculatePart3() {
            const newLinespeed = parseFloat(document.getElementById('part3_new_linespeed').value) || 0;
            const newConsumption = parseFloat(document.getElementById('part3_new_consumption').value) || 0;
            const newRatio = parseFloat(document.getElementById('part3_new_ratio').value) || 0;

            if (newLinespeed <= 0 || newConsumption <= 0 || newRatio <= 0) {
                showError(translations[currentLang].errorPart3);
                return;
            }

            // Calculate new output based on new parameters
            const newOutputGs = (newConsumption * newLinespeed) / 60; // Convert g/m to g/s

            // Calculate component weights based on new ratio
            const totalRatio = 1 + newRatio;
            const polyolWeightGs = newOutputGs / totalRatio;
            const isoWeightGs = polyolWeightGs * newRatio;

            // Calculate RPM adjustments based on Part 2 data
            let polyolRpm = 0;
            let isoRpm = 0;

            if (window.part2Results) {
                // Use Part 2 RPM as baseline and scale based on weight changes
                const polyolScaleFactor = polyolWeightGs / (window.part2Results.outputGs / (1 + window.part2Results.ratio));
                const isoScaleFactor = isoWeightGs / (window.part2Results.outputGs * window.part2Results.ratio / (1 + window.part2Results.ratio));
                
                polyolRpm = (excelData.part2.polyol_rpm * polyolScaleFactor) || polyolWeightGs;
                isoRpm = (excelData.part2.iso_rpm * isoScaleFactor) || (polyolRpm * newRatio / excelData.part2.ratio);
            } else {
                // Use Excel data as fallback
                polyolRpm = excelData.part3.polyol_rpm;
                isoRpm = excelData.part3.iso_rpm;
            }

            const resultContainer = document.getElementById('part3-result-content');
            resultContainer.innerHTML = '';

            // Main output results
            displayResult('part3-result-content', translations[currentLang].totalOutput, newOutputGs.toFixed(2), 'g/s');
            
            // Component breakdown section
            const componentHeader = document.createElement('div');
            componentHeader.className = 'result-section-header';
            componentHeader.innerHTML = `<h4 style="color: #2c3e50; margin: 15px 0 10px 0; font-size: 1.1em;">${translations[currentLang].componentWeights}</h4>`;
            resultContainer.appendChild(componentHeader);
            
            displayResult('part3-result-content', translations[currentLang].polyolWeight, polyolWeightGs.toFixed(2), 'g/s');
            displayResult('part3-result-content', translations[currentLang].isocyanateWeight, isoWeightGs.toFixed(2), 'g/s');

            // Time-based breakdown section
            const timeHeader = document.createElement('div');
            timeHeader.className = 'result-section-header';
            timeHeader.innerHTML = `<h4 style="color: #2c3e50; margin: 15px 0 10px 0; font-size: 1.1em;">${translations[currentLang].timeBasedBreakdown}</h4>`;
            resultContainer.appendChild(timeHeader);
            
            const timeMultipliers = [4, 6];
            let timeBreakdownText = "";
            timeMultipliers.forEach(multiplier => {
                const pol = polyolWeightGs * multiplier;
                const iso = isoWeightGs * multiplier;
                const total = pol + iso;
                const timeLabel = `${multiplier}s`;
                
                timeBreakdownText += `${timeLabel} Total: ${total.toFixed(1)}g (Polyol: ${pol.toFixed(1)}g, Iso: ${iso.toFixed(1)}g)\n`;
                
                // Create a grouped display for each time period
                const timeGroup = document.createElement('div');
                timeGroup.className = 'result-item';
                timeGroup.style.flexDirection = 'column';
                timeGroup.style.alignItems = 'flex-start';
                timeGroup.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 5px;">
                        <span class="result-label" style="font-weight: 700;">${timeLabel} ${translations[currentLang].total}</span>
                        <span class="result-value">${total.toFixed(1)}g</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; width: 100%; font-size: 1.1em; opacity: 0.8;">
                        <span>Polyol: ${pol.toFixed(1)}g</span>
                        <span>Iso: ${iso.toFixed(1)}g</span>
                    </div>
                `;
                resultContainer.appendChild(timeGroup);
            });

            const rpmContainer = document.getElementById('part3-rpm-content');
            rpmContainer.innerHTML = '';

            displayResult('part3-rpm-content', translations[currentLang].polyolRPM, polyolRpm.toFixed(2), 'Hz');
            displayResult('part3-rpm-content', translations[currentLang].isoRPM, isoRpm.toFixed(2), 'Hz');

            document.getElementById('part3-results').style.display = 'block';

            // Generate clipboard text
            let clipboardText = `=== ${translations[currentLang].clipboardHeaders.part3} ===\n\n`;
            clipboardText += `${translations[currentLang].clipboardHeaders.inputParameters}:\n`;
            clipboardText += `${translations[currentLang].newLineSpeed}: ${newLinespeed} ${translations[currentLang].unitMMin.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].newConsumption}: ${newConsumption} ${translations[currentLang].unitGm.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].newRatio}: ${newRatio}\n\n`;

            clipboardText += `${translations[currentLang].clipboardHeaders.results}:\n`;
            clipboardText += `${translations[currentLang].totalOutput}: ${newOutputGs.toFixed(2)} ${translations[currentLang].unitGs.replace('Unit: ', '')}\n\n`;
            
            clipboardText += `${translations[currentLang].componentWeights}:\n`;
            clipboardText += `${translations[currentLang].polyolWeight}: ${polyolWeightGs.toFixed(2)} ${translations[currentLang].unitGs.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].isocyanateWeight}: ${isoWeightGs.toFixed(2)} ${translations[currentLang].unitGs.replace('Unit: ', '')}\n\n`;
            
            clipboardText += `${translations[currentLang].timeBasedBreakdown}:\n`;
            clipboardText += timeBreakdownText + "\n";
            
            clipboardText += `${translations[currentLang].rpmAdjustment}:\n`;
            clipboardText += `${translations[currentLang].polyolRPM}: ${polyolRpm.toFixed(2)} ${translations[currentLang].unitHz.replace('Unit: ', '')}\n`;
            clipboardText += `${translations[currentLang].isoRPM}: ${isoRpm.toFixed(2)} ${translations[currentLang].unitHz.replace('Unit: ', '')}\n\n`;

            // Copy to clipboard
            copyToClipboard(clipboardText);

            // Send data to Google Sheets
            const googleSheetsData = {
                part: 'part3',
                sheetName: 'Part3',
                language: currentLang,
                inputs: {
                    newLinespeed: newLinespeed,
                    newConsumption: newConsumption,
                    newRatio: newRatio
                },
                results: {
                    newOutputGs: newOutputGs.toFixed(2),
                    polyolWeightGs: polyolWeightGs.toFixed(2),
                    isoWeightGs: isoWeightGs.toFixed(2),
                    polyolRpm: polyolRpm.toFixed(2),
                    isoRpm: isoRpm.toFixed(2),
                    timeBreakdown: {
                        '4s': {
                            total: (newOutputGs * 4).toFixed(1),
                            polyol: (polyolWeightGs * 4).toFixed(1),
                            iso: (isoWeightGs * 4).toFixed(1)
                        },
                        '6s': {
                            total: (newOutputGs * 6).toFixed(1),
                            polyol: (polyolWeightGs * 6).toFixed(1),
                            iso: (isoWeightGs * 6).toFixed(1)
                        }
                    }
                }
            };

            sendDataToGoogleSheets(googleSheetsData);
        }

        function clearPart3() {
            document.getElementById('part3_new_linespeed').value = '';
            document.getElementById('part3_new_consumption').value = '';
            document.getElementById('part3_new_ratio').value = '';
            document.getElementById('part3-result-content').innerHTML = '';
            document.getElementById('part3-rpm-content').innerHTML = '';
            document.getElementById('part3-results').style.display = 'none';
        }

        // Utility Functions
        function displayResult(containerId, label, value, unit) {
            const container = document.getElementById(containerId);
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            resultItem.innerHTML = `
                <span class="result-label">${label}</span>
                <span class="result-value">${value} ${unit}</span>
            `;
            container.appendChild(resultItem);
        }

        // Clipboard functionality
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                // Use modern clipboard API
                navigator.clipboard.writeText(text).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    console.error('Failed to copy to clipboard:', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                // Fallback for older browsers or non-HTTPS contexts
                fallbackCopyToClipboard(text);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                console.error('Fallback: Failed to copy to clipboard:', err);
                showCopyError();
            }
            
            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            const successDiv = document.createElement('div');
            successDiv.className = 'copy-notification success';
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            successDiv.textContent = '✓ Copied to clipboard!';
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        function showCopyError() {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'copy-notification error';
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #e74c3c;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            errorDiv.textContent = '✗ Failed to copy to clipboard';
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 3000);
        }

        // Google Sheets Integration Functions
        async function sendDataToGoogleSheets(data) {
            if (!GOOGLE_SHEETS_CONFIG.enabled || GOOGLE_SHEETS_CONFIG.webAppUrl === 'REPLACE_WITH_YOUR_WEBAPP_URL') {
                console.log('Google Sheets integration disabled or URL not configured');
                return;
            }

            try {
                const response = await fetch(GOOGLE_SHEETS_CONFIG.webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors', // Important for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // Note: no-cors mode means we can't read the response, but the request will be sent
                console.log('Data sent to Google Sheets successfully');
                
            } catch (error) {
                console.error('Failed to send data to Google Sheets:', error);
            }
        }


        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'warning';
            errorDiv.innerHTML = message;
            document.querySelector('.main-content').insertBefore(errorDiv, document.querySelector('.part-navigation').nextSibling);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Initialize with default values from the Excel file
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Part 1 values
            document.getElementById('lineSpeed').value = excelData.initial_values.line_speed;
            document.getElementById('output').value = excelData.initial_values.output;
            document.getElementById('concentration').value = excelData.initial_values.concentration;
            document.getElementById('ratio').value = excelData.initial_values.ratio;

            // Initialize Part 2 values
            const part2Data = excelData.part2;
            document.getElementById('part2_linespeed').value = part2Data.linespeed;
            document.getElementById('part2_test_time').value = part2Data.test_time;
            document.getElementById('part2_polyol').value = part2Data.polyol_weight;
            document.getElementById('part2_iso').value = part2Data.iso_weight;
            document.getElementById('part2_polyol_rpm').value = part2Data.polyol_rpm;
            document.getElementById('part2_iso_rpm').value = part2Data.iso_rpm;

            // Initialize Part 3 values
            const part3Data = excelData.part3;
            document.getElementById('part3_new_linespeed').value = part3Data.new_linespeed;
            document.getElementById('part3_new_consumption').value = part3Data.new_consumption_gm;
            document.getElementById('part3_new_ratio').value = part3Data.new_ratio;
        });
    </script>
</body>
</html>